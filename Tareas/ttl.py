#!/usr/bin/python
# -*- coding: utf-8 -*-
# Vallejo Fernández Rafael Alejandro

# Programa que recibe una lista de hosts separados por coma o por espacios e indica que S.O. utiliza el objetivo.

from sys import argv
from subprocess import check_output,check_call,Popen,PIPE
from re import search

def so(ttl):
    """Función que devuelve el S.O. de acuerdo al valor de TTL.
    Recibe: ttl (int)
    Devuelve: S.O. (str)
    """
    if ttl == -1:
        return 'Desconocido'
    elif ttl <= 64:
        return 'Linux'
    elif ttl <= 128:
        return 'Windows'
    elif ttl <= 255:
        return 'Linux'

def ping(host):
    """Función que realiza el ping a un host y devuelve el TTL del paquete enviado.
    Recibe: host (str)
    Devuelve: ttl (int)
    """
    pingProc = Popen(['ping', '-c', '1', host], stdout=PIPE,stderr=PIPE)
    ping = pingProc.communicate()[0]
    if pingProc.returncode == 0:
        ttl = search('ttl=[0-9]+', ping).group(0)
        return int(ttl[ttl.index('=') + 1:])
    else:
        return -1

# main
if len(argv) > 2:
    hosts = argv[1:]
else:
    hosts = argv[1].split(',')

for host in hosts:
    ttl = ping(host)
    print 'Host: \'%s\'   SO: %s (TTL: %i)' % (host, so(ttl), ttl)
